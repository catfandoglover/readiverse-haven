<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>AWS Polly Test</title>
  </head>

  <body>
    <div id="textToSynth">
      <input autofocus size="23" type="text" id="textEntry" value="It's very good to meet you."/>
      <button class="btn default" onClick="speakText()">Synthesize</button>
      <p id="result">Enter text above then click Synthesize</p>
    </div>
    <audio id="audioPlayback" controls>
      <source id="audioSource" type="audio/mp3" src="">
    </audio>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1584.0.min.js"></script>
    <script type="text/javascript">
        // Function to get environment variables from URL parameters
        function getEnvFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return {
                accessKeyId: params.get('accessKeyId'),
                secretAccessKey: params.get('secretAccessKey'),
                region: params.get('region') || 'us-east-1'
            };
        }

        // Get credentials from URL parameters
        const env = getEnvFromUrl();

        // Initialize AWS credentials
        AWS.config.region = env.region;
        AWS.config.credentials = new AWS.Credentials({
            accessKeyId: env.accessKeyId,
            secretAccessKey: env.secretAccessKey
        });

        // Function invoked by button click
        function speakText() {
            // Check if credentials are provided
            if (!env.accessKeyId || !env.secretAccessKey) {
                document.getElementById('result').innerHTML = "Error: Missing AWS credentials. Add them as URL parameters: ?accessKeyId=XXX&secretAccessKey=YYY";
                return;
            }

            // Create the JSON parameters for getSynthesizeSpeechUrl
            var speechParams = {
                OutputFormat: "mp3",
                SampleRate: "16000",
                Text: "",
                TextType: "text",
                VoiceId: "Arthur" // British male voice
            };
            speechParams.Text = document.getElementById("textEntry").value;

            // Create the Polly service object and presigner object
            var polly = new AWS.Polly({apiVersion: '2016-06-10'});
            var signer = new AWS.Polly.Presigner(speechParams, polly)

            // Create presigned URL of synthesized speech file
            signer.getSynthesizeSpeechUrl(speechParams, function(error, url) {
                if (error) {
                    document.getElementById('result').innerHTML = "Error: " + JSON.stringify(error);
                } else {
                    document.getElementById('audioSource').src = url;
                    document.getElementById('audioPlayback').load();
                    document.getElementById('result').innerHTML = "Speech ready to play.";
                }
            });
        }
    </script>
  </body>
</html> 
